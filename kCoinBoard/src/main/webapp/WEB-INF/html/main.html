<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
  layout:decorator="mainLayout">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Cache-Control" content="no-chache"/>
    <meta http-equiv="Expires" content="0"/>
    <meta http-equiv="Pragma" content="no-cache"/>

    <title>K-Coin Board</title>

    <link href="css/bootstrap.min.css" rel="stylesheet"/>
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet"/>

    <link href="css/animate.css" rel="stylesheet"/>
    <link href="css/style.css" rel="stylesheet"/>
    
    <!-- FooTable -->
    <link href="css/plugins/footable/footable.core.css" rel="stylesheet">
    
    <!-- Data table -->
    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    
    <!-- Toastr -->
    <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">
	
	
</head>

<body>

<div layout:fragment="content">
		<div class="row m-t">
                  <div class="col-lg-12">
                      <div class="ibox float-e-margins">
                          <div class="ibox-title">
                              <h5>가상화폐 정보</h5>
                              <div class="ibox-tools">
                                  <a class="collapse-link">
                                      <i class="fa fa-chevron-up"></i>
                                  </a>
                                  <a class="close-link">
                                      <i class="fa fa-times"></i>
                                  </a>
                              </div>
                          </div>
                          <div class="ibox-content">
                              <div class="table-responsive">
                                  <table class="footable table table-striped" id="coinTable" data-sorting="true" data-page-size="15">
                                      <thead>
                                      <tr>
                                          <th>Coin</th>
                                          <th>Symbol</th>
                                          <th class="text-info">USD</th>
                                          <th class="text-warning">BitThumb(KRW)</th>
                                          <th class="text-warning">빗썸 premium</th>
                                          <th class="text-success">Upbit(KRW)</th>
                                          <th class="text-success">업빗 premium</th>
                                          <th class="text-danger">빗썸 - 업빗</th>
                                      </tr>
                                      </thead>
                                      <tbody>
                                      <tr>
                                          <td>비트코인</td>
                                          <td>BTC</td>
                                          <td id="btfBTCUSD"></td>
                                          <td id="btbBTCKRW"></td>
                                          <td id="btbBTCKp"></td>
                                          <td id="ubtBTCKRW"></td>
                                          <td id="ubtBTCKp"></td>
                                          <td id="difBTC"></td>
                                      </tr>
                                      <tr>
                                          <td>리플</td>
                                          <td>XRP</td>
                                          <td id="btfXRPUSD"></td>
                                          <td id="btbXRPKRW"></td>
                                          <td id="btbXRPKp"></td>
                                          <td id="ubtXRPKRW"></td>
                                          <td id="ubtXRPKp"></td>
                                          <td id="difXRP"></td>
                                      </tr>
                                      <tr>
                                          <td>이더리움</td>
                                          <td>ETH</td>
                                          <td id="btfETHUSD"></td>
                                          <td id="btbETHKRW"></td>
                                          <td id="btbETHKp"></td>
                                          <td id="ubtETHKRW"></td>
                                          <td id="ubtETHKp"></td>
                                          <td id="difETH"></td>
                                      </tr>
                                      <tr>
                                          <td>비트코인 캐시</td>
                                          <td>BCH</td>
                                          <td id="btfBCHUSD"></td>
                                          <td id="btbBCHKRW"></td>
                                          <td id="btbBCHKp"></td>
                                          <td id="ubtBCHKRW"></td>
                                          <td id="ubtBCHKp"></td>
                                          <td id="difBCH"></td>
                                      </tr>
                                      <tr>
                                          <td>라이트코인</td>
                                          <td>LTC</td>
                                          <td id="btfLTCUSD"></td>
                                          <td id="btbLTCKRW"></td>
                                          <td id="btbLTCKp"></td>
                                          <td id="ubtLTCKRW"></td>
                                          <td id="ubtLTCKp"></td>
                                          <td id="difLTC"></td>
                                      </tr>
                                      <tr>
                                          <td>대시</td>
                                          <td>DASH</td>
                                          <td id="btfDASHUSD"></td>
                                          <td id="btbDASHKRW"></td>
                                          <td id="btbDASHKp"></td>
                                          <td id="ubtDASHKRW"></td>
                                          <td id="ubtDASHKp"></td>
                                          <td id="difDASH"></td>
                                      </tr>
                                      <tr>
                                          <td>모네로</td>
                                          <td>XMR</td>
                                          <td id="btfXMRUSD"></td>
                                          <td id="btbXMRKRW"></td>
                                          <td id="btbXMRKp"></td>
                                          <td id="ubtXMRKRW"></td>
                                          <td id="ubtXMRKp"></td>
                                          <td id="difXMR"></td>
                                      </tr>
                                      <tr>
                                          <td>이오스</td>
                                          <td>EOS</td>
                                          <td id="btfEOSUSD"></td>
                                          <td id="btbEOSKRW"></td>
                                          <td id="btbEOSKp"></td>
                                          <td id="ubtEOSKRW"></td>
                                          <td id="ubtEOSKp"></td>
                                          <td id="difEOS"></td>
                                      </tr>
                                      <tr>
                                          <td>퀀텀</td>
                                          <td>QTUM</td>
                                          <td id="btfQTUMUSD"></td>
                                          <td id="btbQTUMKRW"></td>
                                          <td id="btbQTUMKp"></td>
                                          <td id="ubtQTUMKRW"></td>
                                          <td id="ubtQTUMKp"></td>
                                          <td id="difQTUM"></td>
                                      </tr>
                                      <tr>
                                          <td>비트코인 골드</td>
                                          <td>BTG</td>
                                          <td id="btfBTGUSD"></td>
                                          <td id="btbBTGKRW"></td>
                                          <td id="btbBTGKp"></td>
                                          <td id="ubtBTGKRW"></td>
                                          <td id="ubtBTGKp"></td>
                                          <td id="difBTG"></td>
                                      </tr>
                                      <tr>
                                          <td>제트캐시</td>
                                          <td>ZEC</td>
                                          <td id="btfZECUSD"></td>
                                          <td id="btbZECKRW"></td>
                                          <td id="btbZECKp"></td>
                                          <td id="ubtZECKRW"></td>
                                          <td id="ubtZECKp"></td>
                                          <td id="difZEC"></td>
                                      </tr>
                                      <tr>
                                          <td>이더리움 클래식</td>
                                          <td>ETC</td>
                                          <td id="btfETCUSD"></td>
                                          <td id="btbETCKRW"></td>
                                          <td id="btbETCKp"></td>
                                          <td id="ubtETCKRW"></td>
                                          <td id="ubtETCKp"></td>
                                          <td id="difETC"></td>
                                      </tr>
                                      </tbody>
                                  </table>
                              </div>

                          </div>
                      </div>
                  </div>
              </div>
        <div class="row m-r m-b" align="right">
        	<button id="reloadBtn" type="button" class="btn btn-w-m btn-primary">Reload Now</button>
        </div>   
        <div class="row">
            <div class="col-md-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-success pull-right">Today</span>
                        <h5>BitCoin(BTC)</h5>
                    </div>
                    <div class="ibox-content">
                    	<h2 class="font-bold text-warning">Bithumb</h2>
                    	<div class="row">
                    		<div class="col-md-4">
		                    	<h3 class="font-bold">KRW</h3>
		                        <h1 class="no-margins" id="btbBtcKRWMain"></h1>
	                        </div>
                    		<div class="col-md-4">
		                    	<h3 class="font-bold">USD by bitfinex</h3>
		                        <h1 class="no-margins" id="btbBtcUSDMain"></h1>
	                        </div>
                    		<div class="col-md-4">
		                    	<h3 class="font-bold">Korea Premium</h3>
		                        <h1 class="no-margins" id="btbBtcKp"></h1>
	                        </div>
                        </div>
                        <hr>
                        <h2 class="font-bold text-success">Upbit</h2>
                    	<div class="row">
                    		<div class="col-md-4">
		                    	<h3 class="font-bold">KRW</h3>
		                        <h1 class="no-margins" id="ubtBtcKRWMain"></h1>
	                        </div>
                    		<div class="col-md-4">
		                    	<h3 class="font-bold">USD by bitfinex</h3>
		                        <h1 class="no-margins" id="ubtBtcUSDMain"></h1>
	                        </div>
	                        <div class="col-md-4">
		                    	<h3 class="font-bold">Korea Premium</h3>
		                        <h1 class="no-margins" id="ubtBtcKp"></h1>
	                        </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                    	<!--Currency Converter widget by FreeCurrencyRates.com -->

<div id='gcw_mainFz3t9UNup' class='gcw_mainFz3t9UNup'></div>
<a id='gcw_siteFz3t9UNup' href='https://freecurrencyrates.com/en/'>FreeCurrencyRates.com</a>
<script>function reloadFz3t9UNup(){ var sc = document.getElementById('scFz3t9UNup');if (sc) sc.parentNode.removeChild(sc);sc = document.createElement('script');sc.type = 'text/javascript';sc.charset = 'UTF-8';sc.async = true;sc.id='scFz3t9UNup';sc.src = 'https://freecurrencyrates.com/en/widget-vertical?iso=USDEURGBPJPYCNYXUL&df=1&p=Fz3t9UNup&v=fits&source=fcr&width=245&width_title=0&firstrowvalue=1&thm=A6C9E2,FCFDFD,4297D7,5C9CCC,FFFFFF,C5DBEC,FCFDFD,2E6E9E,000000&title=Currency%20Converter&tzo=-540';var div = document.getElementById('gcw_mainFz3t9UNup');div.parentNode.insertBefore(sc, div);} reloadFz3t9UNup(); </script>
<!-- put custom styles here: .gcw_mainFz3t9UNup{}, .gcw_headerFz3t9UNup{}, .gcw_ratesFz3t9UNup{}, .gcw_sourceFz3t9UNup{} -->
<!--End of Currency Converter widget by FreeCurrencyRates.com -->
            </div>
        </div>     
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="text-center">
                        <small>
                                                                 제작자 : Catchup <br>
							blog :  <a href="http://www.leafcats.com">www.leafcats.com</a> / Email : leafcatCoin@gmail.com <br>
                                                                 현재 환율 : <label id="curRate"></label>
                        </small>
                    </div>
                </div>
            </div>
        </div>
        <!-- Toastr 연습 -->
        <div class="ibox-content" hidden="">
            <h3 class="font-bold">
            	스크립트 테스트
            </h3>
            <p>
                <button id="test1" type="button" class="btn btn-w-m btn-primary">Toastr success</button>
                <button id="test2" type="button" class="btn btn-w-m btn-info">Toastr info</button>
                <button id="test3" type="button" class="btn btn-w-m btn-danger">Toastr error</button>
                <button id="test4" type="button" class="btn btn-w-m btn-warning">Toastr info</button>
                <button id="json" type="button" class="btn btn-w-m btn-warning">Toastr info</button>
            </p>
        </div>


	<!-- datatables -->
    <script src="js/plugins/dataTables/datatables.min.js"></script>

    <!-- FooTable -->
    <script src="js/plugins/footable/footable.all.min.js"></script>
    
	<!-- Toaster -->
    <script src="js/plugins/toastr/toastr.min.js"></script>    
    
	<script type="text/javascript">
	var CUR_RATE = 1068.50;
	var COIN_TABLE;
	
	function getCurRate(){
/*         $.getJSON("https://api.manana.kr/exchange/rate/KRW/USD.json",
	        function(data) {
        		CUR_RATE = data[0].rate;
	       		$('#curRate').html(CUR_RATE);
	       		calKP();
	        });    */
		
	}
	
	//bithumb 가격조회
   function getBtb(){ 
		//비트코인(BTC)
         $.getJSON("https://api.bithumb.com/public/recent_transactions/BTC",
         function(data) {
        	$('#btbBTCKRW').val(data.data[0].price);
        	$('#btbBtcKRWMain').val(data.data[0].price);
        	$('#btbBtcKRWMain').html(data.data[0].price);
        	calKP("btbBtcKRWMain", "btbBtcUSDMain", "btbBtcKp");
          });
         //리플(XRP)
         callBithumbAPI("XRP","btbXRPKRW")
         //이더리움(ETH)
         callBithumbAPI("ETH","btbETHKRW")
         //비트코인캐시(BCH)
         callBithumbAPI("BCH","btbBCHKRW")
         //비트코인골드(BTG)
         callBithumbAPI("BTG","btbBTGKRW")
         //이더리움클래식(ETC)
         callBithumbAPI("ETC","btbETCKRW")
         //대시(DASH)
         callBithumbAPI("DASH","btbDASHKRW")
         //모네로(XMR)
         callBithumbAPI("XMR","btbXMRKRW")
         //이오스(EOS)
         callBithumbAPI("EOS","btbEOSKRW")
         //퀀텀(QTUM)
         callBithumbAPI("QTUM","btbQTUMKRW")
         //제트캐시(ZEC)
         callBithumbAPI("ZEC","btbZECKRW")
         //라이트코인(LTC)
         callBithumbAPI("LTC","btbLTCKRW")
    };
    
    function callBithumbAPI(cur,id){
        $.getJSON("https://api.bithumb.com/public/recent_transactions/" + cur,
                function(data) {
               	$('#'+id).val(data.data[0].price);
                 });
    }
    
    function getUbt(){
         $.getJSON("https://crix-api-endpoint.upbit.com/v1/crix/candles/minutes/30?code=CRIX.UPBIT.KRW-BTC&count=1",
         function(data) {
        	$('#ubtBtcKRWMain').val(data[0].tradePrice);
        	$('#ubtBtcKRWMain').html(numberWithCommas(data[0].tradePrice));
        	calKP("ubtBtcKRWMain", "ubtBtcUSDMain", "ubtBtcKp");
          });   
    }
    
    function calKP(kr, us, target){
    	if($('#'+ kr).html() != "" && $('#' + us).html() != ""){
	    	$("#"+ target).html( ( ($('#'+ kr).html() - $('#' + us).html() * CUR_RATE ) / ($('#' + us).html() * CUR_RATE) * 100 ).toFixed(2) + "%");
    	}
    }
    
    //USD from bitfinex
    function getUsPrice(){
       	//BTC
         $.getJSON("https://api.bitfinex.com/v2/trades/tBTCUSD/hist",
         function(data) {
        	$('#btbBtcUSDMain').val(data[0][3]);
        	$('#ubtBtcUSDMain').val(data[0][3]);
        	$('#btbBtcUSDMain').html(numberWithCommas(data[0][3]));
        	$('#ubtBtcUSDMain').html(numberWithCommas(data[0][3]));
        	calKP("btbBtcKRWMain", "btbBtcUSDMain", "btbBtcKp");
        	calKP("ubtBtcKRWMain", "ubtBtcUSDMain", "ubtBtcKp");
          });  
       	
          //리플(XRP)
         callBitfinexAPI("XRP","XRPUSD")
         //이더리움(ETH)
         callBitfinexAPI("ETH","ETHUSD")
         //비트코인캐시(BCH)
         callBitfinexAPI("BCH","BCHUSD")
         //비트코인골드(BTG)
         callBitfinexAPI("BTG","BTGUSD")
         //이더리움클래식(ETC)
         callBitfinexAPI("ETC","ETCUSD")
         //대시(DASH)
         callBitfinexAPI("DASH","DASHUSD")
         //모네로(XMR)
         callBitfinexAPI("XMR","XMRUSD")
         //이오스(EOS)
         callBitfinexAPI("EOS","EOSUSD")
         //퀀텀(QTUM)
         callBitfinexAPI("QTUM","QTUMUSD")
         //제트캐시(ZEC)
         callBitfinexAPI("ZEC","ZECUSD")
         //라이트코인(LTC)
         callBitfinexAPI("LTC","LTCUSD") 
         
       	
    }
    function callBitfinexAPI(cur,id){
        $.getJSON("https://api.bitfinex.com/v2/trades/t"+ cur + "USD/hist",
                function(data) {
               	$('#'+id).val(data[0][3]);
                 });
    }
    
    
    
    
    
		$("#test1").click(function(){
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    showMethod: 'slideDown',
                    timeOut: 4000
                };
                toastr.success('www.leafcats.com', 'Toastr success!');
		});
		$("#test2").click(function(){
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    showMethod: 'slideDown',
                    timeOut: 4000
                };
                toastr.info('www.leafcats.com', 'Toastr info!');
		});
		$("#test3").click(function(){
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    showMethod: 'slideDown',
                    timeOut: 4000
                };
                toastr.error('www.leafcats.com', 'Toastr error!');
		});
		$("#test4").click(function(){
			
  	        $.ajax({
  	            url:'/test.go',
  	            type:'post',
  	            success:function(data){
  	            	alert(data.loginErr);
  	            }
  	        })

		});
	
		function numberWithCommas(x) { return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); }

	    $("#reloadBtn").click(function(){
	    	$('#reloadBtn').prop("disabled",true);
	    	setTimeout(function(){
	    		$('#reloadBtn').prop("disabled",false);
	    	}, 3000);
	    	getCoinPrice();
	    });
	    
		function setValue(){
			getCurRate();
		//	getBtb();
			getUbt();
			getUsPrice();
		}

		
	    function setCoinTable2(){
	    	COIN_TABLE = $('#coinTable').dataTable({
				pageLength: 15,
				responsive: true,
				bAutoWidth: false,
				processing: true,
				ordering: true,
				searching: true,
		        dom: '<"html5buttons"B>f',
		        buttons: [
	 	            {extend: 'copy'},
		            {extend: 'csv'},
		            {extend: 'excel', title: 'ExampleFile'},
		            {extend: 'pdf', title: 'ExampleFile'},
		            {extend: 'print',
		             customize: function (win){
		                    $(win.document.body).addClass('white-bg');
		                    $(win.document.body).css('font-size', '10px');
		                    $(win.document.body).find('table')
		                            .addClass('compact')
		                            .css('font-size', 'inherit');
		            }
		            } 
		        ]
		
		    });
	    }
	    
	    function setCoinTable(){
	    	$('#coinTable').footable();
	    	
	    }
	    
	    function getCoinPrice(){
		    $.ajax({
				headers:{
					'Accept':'application/json'
				},
	            type : "GET",
	            url : "/getCoinPrice",
	            dataType : "json",
	            error : function(){
	                alert('통신실패!!');
	            },
	            success : function(data){
	            	var coinArr = data.data;
	            	CUR_RATE = data.exchange.exRate;
	            	var id = '';
	            	var usId = '';
	            	var kpId= '';
	            	var btbId = '';
	            	var difId = '';
	            	for(i=0 ; i < coinArr.length ; i++ ){
	            		if(coinArr[i].marketId == 1){
	            			id = 'btf';
	            		}else if(coinArr[i].marketId == 2){
	            			id = 'btb';
	            		}else if (coinArr[i].marketId == 3){
	            			id = 'ubt';
	            			difId = 'dif' + coinArr[i].coinSymbol;
	            			btbId = 'btb' + coinArr[i].coinSymbol + coinArr[i].currency;
	            		}
	            		kpId = id + coinArr[i].coinSymbol + 'Kp';
	            		
	            		id = id + coinArr[i].coinSymbol + coinArr[i].currency;
	            		$("#"+id).html(coinArr[i].price);  
	            		
	            		if(coinArr[i].marketId != 1){
		            		usId = 'btf' + coinArr[i].coinSymbol + 'USD';
		            		calKP(id, usId, kpId);
	            		}
	            		
	            		if(coinArr[i].marketId == 3){
	            			$("#"+difId).html( $("#"+btbId).html() -coinArr[i].price);
	            		}
	            	}
	            	
	            	
	            	
	            	$("#btbBtcKRWMain").html(numberWithCommas($("#btbBTCKRW").html()));
	            	$("#btbBtcUSDMain").html(numberWithCommas($("#btfBTCUSD").html()));
	            	$("#btbBtcKp").html($("#btbBTCKp").html());
	            	
	            	$("#ubtBtcKRWMain").html(numberWithCommas($("#ubtBTCKRW").html()));
	            	$("#ubtBtcUSDMain").html(numberWithCommas($("#btfBTCUSD").html()));
	            	$("#ubtBtcKp").html($("#ubtBTCKp").html());
	            	
	            	
	            }
	             
	        });
	    }


		var callNewPrice = setInterval(function() {
			getCoinPrice();
		}, 5000);
		
		$(document).ready(function(){
			getCoinPrice();
			setCoinTable();
		});
		
	</script>

</div>

</body>
</html>
